<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>

<!-- Custom Theme JavaScript -->
<script src="/public/shinjam-blog.js"></script>

<!-- Service Worker -->
<script src="/pwa/sw-registration.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
{% include_cached analytics.html %}

<!-- async load function -->
<script>
    function async(u, c) {
        var d = document,
            t = "script",
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) {
            o.addEventListener(
                "load",
                function (e) {
                    c(null, e);
                },
                false
            );
        }
        s.parentNode.insertBefore(o, s);
    }
</script>

{% if page.title == 'Archive' %}
<!-- jquery.tagcloud.js -->
<script>
    async("/public/jquery.tagcloud.js", function () {
        $("#tag_cloud a").tagcloud({
            color: { start: "#bbbbee", end: "#2f93b4" },
            size: { start: 14, end: 18, unit: "pt" },
        });
    });
</script>
<script src="/public/archive.js"></script>
{% endif %}

<!-- Side Catalog -->
{% if page.catalog != false or page.catalog %}
<script type="text/javascript">
    function generateCatalog(selector) {
        // interop with multilangual
        if ("{{ page.multilingual }}" == "true") {
            _containerSelector = "div.post-container.active";
        } else {
            _containerSelector = "div.post-container";
        }

        // init
        var P = $(_containerSelector),
            a,
            n,
            t,
            l,
            i,
            c;
        a = P.find("h1,h2,h3,h4,h5,h6");

        // clean
        $(selector).html("");

        // appending
        a.each(function () {
            n = $(this).prop("tagName").toLowerCase();
            i = "#" + $(this).prop("id");
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + "</a>");
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click(function (e) {
        e.preventDefault();
        $(".side-catalog").toggleClass("fold");
    });

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/public/jquery.nav.js", function () {
        $(".catalog-body").onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: 0.2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80,
        });
    });
</script>
{% endif %}

<!-- Multi-Lingual -->
{% if page.multilingual %}
<!-- Handle Language Change -->
<script type="text/javascript">
    // get nodes
    var $ko = document.querySelector(".ko");
    var $en = document.querySelector(".en");
    var $select = document.querySelector("select");

    // Changes at v1.8.1: include lang flag as a url query. This interop well with catalog hash anchors.
    function getLang() {
        return new URLSearchParams(document.location.search).get("lang");
    }

    function setLang(newLang) {
        var params = new URLSearchParams(document.location.search);
        params.set("lang", newLang);
        document.location.search = params.toString(); // refresh.
    }

    // handle render
    function _render() {
        var lang = getLang();
        // en
        if (lang == "en") {
            $select.selectedIndex = 1;
            $en.style.display = "block";
            $en.classList.add("active");
            $ko.style.display = "none";
            $ko.classList.remove("active");
            // default to ko-cn
        } else {
            $select.selectedIndex = 0;
            $ko.style.display = "block";
            $ko.classList.add("active");
            $en.style.display = "none";
            $en.classList.remove("active");
        }
        // interop with catalog
        if ("{{ page.catalog }}") generateCatalog(".catalog-body");
    }

    // handle select change
    function onLanChange(index) {
        if (index == 0) {
            lang = "ko";
        } else {
            lang = "en";
        }
        setLang(lang);
    }

    // init
    _render();
</script>
{% endif %}